
aws_push_docker_image:
  image: registry.seu-registry.io/seu-registry/appsec/base-images/docker-run/docker20:0.1
  only:
    - /^v[0-9]+.[0-9]+.[0-9]+-aws/
  stage: push_docker
  when: manual
  dependencies:
    - build
  script:
    - docker build --build-arg ARTIFACT_NAME=${ARTIFACT_NAME} --build-arg AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} --build-arg AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} --tag registry.seu-registry.io/seu-registry/${APP_NAME}:${PACKAGE_VERSION}-${CI_PIPELINE_ID} -f ./build/docker/Dockerfile .
    - docker push registry.seu-registry.io/seu-registry/${APP_NAME}:${PACKAGE_VERSION}-${CI_PIPELINE_ID}
  environment:
    name: registry.seu-registry.io
    url: https://registry.seu-registry.io/v2/seu-registry/${APP_NAME}/tags/list
